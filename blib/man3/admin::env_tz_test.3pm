.\" Automatically generated by Pod::Man 2.25 (Pod::Simple 3.16)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "admin::env_tz_test 3pm"
.TH admin::env_tz_test 3pm "2012-07-23" "perl v5.14.2" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "MULTIPLE TIME ZONE SUPPORT"
.IX Header "MULTIPLE TIME ZONE SUPPORT"
Koha supports running multiple instances on the same server, even if they need to be homed
in different timezones.  However, your database must have the timezones installed (see below).
.PP
If you are only running one installation of Koha, and want to change the timezone of the server,
please do \s-1NOT\s0 use this feature at all, and instead set your system timezone via the \s-1OS\s0.  If you 
are running multiple Kohas, all in the same timezone, do the same.
.PP
Only use this feature if
you are running multiple Kohas on the same server, and they are not in the same timezone.
.SS "Perl"
.IX Subsection "Perl"
For the most part, in execution perl will respect the environmental
variable \s-1TZ\s0, if it is set.  This affects calls to \fIlocaltime()\fR and other similar functions.
Remember that the environment will be different for different users, and for cron jobs.  
See the example below.
.SS "Apache2"
.IX Subsection "Apache2"
We affect the running perl code of Koha with the Apache directive:
.PP
SetEnv \s-1TZ\s0 \*(L"US/Central\*(R"
.PP
This should be added inside the VirtualHost definition for the intended Koha instance.  In 
almost \s-1ALL\s0 cases, be sure to set it for both \s-1INTRANET\s0 and \s-1OPAC\s0 VirtualHosts.  Remember this
does not affect the command line environment for any terminal sessions, or your cron jobs.
.SS "Database (mysql)"
.IX Subsection "Database (mysql)"
Your MySQL installation must be configured with appropriate time zones.  This extends beyond
Koha and affects mysql itself.  On debian, for example, you can use:
.PP
.Vb 1
\&        mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql \-u root mysql
.Ve
.PP
See http://dev.mysql.com/doc/refman/5.0/en/time\-zone\-support.html
.SS "cron/crontab"
.IX Subsection "cron/crontab"
Current versions of cron in debian allow \s-1ENV\s0 variables to be set in the lines preceeding 
scheduled commands.  They will be exported to the environment of the scheduled job.  This is 
an example for crontab:
.PP
.Vb 5
\&        TZ="US/Central"
\&        # m h  dom mon dow   command
\&        0  1 * * *  /home/liblime/kohaclone/misc/cronjobs/overdue_notices.pl
\&        15 * * * *  /home/liblime/kohaclone/misc/cronjobs/process_message_queue.pl
\&        */10 * * * *   /home/liblime/kohaclone/misc/migration_tools/rebuild_zebra.pl \-b \-z >/dev/null
.Ve
.SH "EXAMPLE"
.IX Header "EXAMPLE"
Try these on a command line to confirm Context is setting time_zone based on \s-1TZ:\s0
.PP
perl \-MC4::Context \-e 'my \f(CW$dbh\fR=C4::Context\->dbh; my \f(CW$tz_sth\fR=$dbh\->prepare(q(\s-1SHOW\s0 \s-1VARIABLES\s0 \s-1LIKE\s0 \*(L"time_zone\*(R"));
 	\f(CW$tz_sth\fR\->\fIexecute()\fR; print \*(L"mysql dbh (Context) time_zone : \*(R" .  \f(CW$tz_sth\fR\->fetchrow, \*(L"\en\*(R";'
.PP
export TZ=\*(L"US/Central\*(R";  # or any \s-1TZ\s0 other than the current one.
.PP
perl \-MC4::Context \-e 'my \f(CW$dbh\fR=C4::Context\->dbh; my \f(CW$tz_sth\fR=$dbh\->prepare(q(\s-1SHOW\s0 \s-1VARIABLES\s0 \s-1LIKE\s0 \*(L"time_zone\*(R"));
 	\f(CW$tz_sth\fR\->\fIexecute()\fR; print \*(L"mysql dbh (Context) time_zone : \*(R" .  \f(CW$tz_sth\fR\->fetchrow, \*(L"\en\*(R";'
.PP
Then update your VirtualHosts to do, for example:
.PP
.Vb 1
\&        SetEnv TZ "US/Central"
.Ve
.PP
Reset Apache, then on your intranet check out the debug page:
.PP
.Vb 1
\&        cgi\-bin/koha/admin/env_tz_test.pl
.Ve
.PP
The \s-1TZ\s0 that Koha has in effect and the \s-1TZ\s0 from the database should be displayed at the bottom.
Hopefully they match what you set.
.SH "BUGS"
.IX Header "BUGS"
\&\s-1WARNING:\s0 Multiple timezones may or may not work under mod_perl and mod_perl2.
.SH "AUTHOR"
.IX Header "AUTHOR"
.Vb 2
\&        Joe Atzberger
\&        atz at liblime.com
.Ve
